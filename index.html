<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèπ Tiro con Arco Virtual - Enhanced</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Serif JP', serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            overflow: hidden;
            height: 100vh;
        }

        /* Animaciones */
        @keyframes fadeOutScreen {
            to {
                opacity: 0;
                transform: scale(0.95);
                pointer-events: none;
            }
        }

        @keyframes pulse-zen {

            0%,
            100% {
                transform: scale(1);
                border-color: rgba(255, 215, 0, 0.6);
            }

            50% {
                transform: scale(1.05);
                border-color: rgba(255, 215, 0, 0.9);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .intro-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
        }

        .intro-screen.hidden {
            animation: fadeOutScreen 0.8s ease-out forwards;
        }

        .zen-circle {
            width: 200px;
            height: 200px;
            border: 3px solid rgba(255, 215, 0, 0.6);
            border-radius: 50%;
            position: relative;
            margin-bottom: 40px;
            animation: pulse-zen 3s ease-in-out infinite;
        }

        .zen-circle::before {
            content: 'Âºì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            color: rgba(255, 215, 0, 0.8);
        }

        .intro-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
            font-weight: 600;
            letter-spacing: 4px;
            text-align: center;
        }

        .intro-subtitle {
            font-size: 1em;
            margin-bottom: 40px;
            color: rgba(255, 215, 0, 0.8);
            font-weight: 300;
            letter-spacing: 8px;
            text-align: center;
        }

        .philosophy-text {
            max-width: 500px;
            text-align: center;
            line-height: 1.8;
            margin-bottom: 40px;
            padding: 0 20px;
            font-weight: 300;
            font-size: 0.95em;
            color: rgba(255, 255, 255, 0.85);
        }

        .start-btn {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%);
            color: #ffd700;
            border: 2px solid rgba(255, 215, 0, 0.6);
            padding: 15px 50px;
            font-size: 1.1em;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 400;
            letter-spacing: 3px;
            font-family: 'Noto Serif JP', serif;
            position: relative;
            overflow: hidden;
        }

        .start-btn:hover {
            background: rgba(255, 215, 0, 0.15);
            border-color: rgba(255, 215, 0, 0.9);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: none;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a0f 100%);
        }

        .container.active {
            display: block;
        }

        #video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            opacity: 0.85;
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        .hud {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            color: white;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.9);
            font-family: 'Noto Serif JP', serif;
        }

        .score {
            font-size: 1.8em;
            font-weight: 300;
            margin-bottom: 10px;
            letter-spacing: 2px;
            color: #ffd700;
        }

        .score.player1 {
            color: #00d4ff;
        }

        .score.player2 {
            color: #ff6b9d;
        }

        .status {
            font-size: 1em;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 16px;
            border-left: 3px solid rgba(255, 215, 0, 0.6);
            margin-bottom: 8px;
            font-weight: 300;
            letter-spacing: 1px;
            backdrop-filter: blur(10px);
        }

        .wind-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 5px;
        }

        .wind-arrow {
            font-size: 1.2em;
            color: #ffd700;
            transition: transform 0.5s ease;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 10;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 215, 0, 0.6);
            color: #ffd700;
            padding: 10px 20px;
            font-family: 'Noto Serif JP', serif;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            letter-spacing: 1px;
            font-weight: 300;
        }

        .control-btn:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .control-btn.active {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        .info-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 215, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .info-icon:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: scale(1.1);
        }

        .info-icon::before {
            content: '‚Ñπ';
            color: #ffd700;
            font-size: 24px;
            font-weight: bold;
        }

        .instructions {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 20px;
            border-left: 3px solid rgba(255, 215, 0, 0.6);
            max-width: 280px;
            z-index: 9;
            font-size: 0.85em;
            line-height: 1.8;
            backdrop-filter: blur(10px);
            transform: translateX(350px);
            transition: transform 0.3s ease;
            font-family: 'Noto Serif JP', serif;
            font-weight: 300;
        }

        .instructions.show {
            transform: translateX(0);
        }

        .target {
            position: absolute;
            top: 50%;
            right: 10%;
            transform: translate(0, -50%);
            width: 200px;
            height: 200px;
            z-index: 1;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.3));
        }

        .target-ring {
            position: absolute;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .ring-1 {
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(0, 0, 0, 0.3);
        }

        .ring-2 {
            width: 160px;
            height: 160px;
            background: rgba(0, 0, 0, 0.9);
        }

        .ring-3 {
            width: 120px;
            height: 120px;
            background: rgba(0, 100, 255, 0.9);
        }

        .ring-4 {
            width: 80px;
            height: 80px;
            background: rgba(255, 0, 0, 0.9);
        }

        .ring-5 {
            width: 40px;
            height: 40px;
            background: rgba(255, 215, 0, 0.95);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .result-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(15, 15, 30, 0.98);
            padding: 50px 70px;
            border: 2px solid rgba(255, 215, 0, 0.6);
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
            z-index: 100;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            backdrop-filter: blur(20px);
            font-family: 'Noto Serif JP', serif;
        }

        .result-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .result-title {
            font-size: 1.8em;
            color: #ffd700;
            margin-bottom: 20px;
            letter-spacing: 3px;
        }

        .result-score {
            font-size: 5em;
            color: #ffd700;
            margin-bottom: 15px;
            font-weight: 300;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .result-message {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 30px;
            letter-spacing: 2px;
        }

        .zen-phrase {
            font-size: 0.9em;
            color: rgba(255, 215, 0, 0.8);
            margin-bottom: 20px;
            font-style: italic;
        }

        .continue-btn {
            background: rgba(255, 215, 0, 0.1);
            color: #ffd700;
            border: 2px solid rgba(255, 215, 0, 0.6);
            padding: 12px 35px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Noto Serif JP', serif;
            letter-spacing: 2px;
        }

        .continue-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.05);
        }

        .power-bar {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            height: 8px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 215, 0, 0.4);
            overflow: hidden;
            z-index: 10;
            display: none;
            backdrop-filter: blur(10px);
        }

        .power-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
            transition: width 0.05s linear;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        .power-label {
            position: absolute;
            bottom: 55px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffd700;
            font-size: 0.9em;
            letter-spacing: 2px;
            display: none;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            font-family: 'Noto Serif JP', serif;
        }

        .arrow {
            position: absolute;
            width: 120px;
            height: 4px;
            background: linear-gradient(90deg, #8B4513 0%, #D2691E 80%, #FFD700 100%);
            z-index: 5;
            display: none;
            transform-origin: left center;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
        }

        .arrow::before {
            content: '';
            position: absolute;
            right: -12px;
            top: -6px;
            width: 0;
            height: 0;
            border-left: 18px solid #FFD700;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
        }

        .arrow::after {
            content: '';
            position: absolute;
            left: 0;
            top: -4px;
            width: 25px;
            height: 12px;
            background: #654321;
            border-radius: 0 6px 6px 0;
        }

        .arrow.player1 {
            background: linear-gradient(90deg, #8B4513 0%, #00a8cc 80%, #00d4ff 100%);
        }

        .arrow.player1::before {
            border-left-color: #00d4ff;
        }

        .arrow.player2 {
            background: linear-gradient(90deg, #8B4513 0%, #c44569 80%, #ff6b9d 100%);
        }

        .arrow.player2::before {
            border-left-color: #ff6b9d;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffd700;
            font-size: 1.3em;
            text-align: center;
            z-index: 1000;
            font-family: 'Noto Serif JP', serif;
            letter-spacing: 2px;
        }

        .zen-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 215, 0, 0.9);
            font-size: 1.5em;
            text-align: center;
            z-index: 8;
            font-family: 'Noto Serif JP', serif;
            letter-spacing: 3px;
            opacity: 0;
            transition: opacity 0.5s ease;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            pointer-events: none;
        }

        .zen-message.show {
            opacity: 1;
        }

        .winner-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(15, 15, 30, 0.98);
            padding: 60px 80px;
            z-index: 200;
            text-align: center;
            border: 3px solid rgba(255, 215, 0, 0.8);
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.5);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            backdrop-filter: blur(20px);
            font-family: 'Noto Serif JP', serif;
        }

        .winner-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .winner-title {
            font-size: 3em;
            margin-bottom: 20px;
            letter-spacing: 4px;
        }

        .winner-title.player1 {
            color: #00d4ff;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.8);
        }

        .winner-title.player2 {
            color: #ff6b9d;
            text-shadow: 0 0 30px rgba(255, 107, 157, 0.8);
        }

        .winner-scores {
            font-size: 2em;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 30px;
        }

        .winner-message {
            font-size: 1.3em;
            color: #ffd700;
            margin-bottom: 35px;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div class="intro-screen" id="introScreen">
        <div class="zen-circle"></div>
        <div class="intro-title">ÂºìÈÅì KY≈™D≈å</div>
        <div class="intro-subtitle">EL CAMINO DEL ARCO</div>
        <div class="philosophy-text">
            "En Ky≈´d≈ç, no se trata de dar en el blanco, sino de perfeccionar el esp√≠ritu.<br>
            El arco y la flecha son extensiones del alma.<br>
            Con cada disparo, encontramos el equilibrio interior."
        </div>
        <button class="start-btn" id="startBtn"><span>Âßã„ÇÅ„Çã COMENZAR</span></button>
    </div>

    <div class="container" id="gameContainer">
        <div class="loading" id="loading">Ëµ∑Âãï‰∏≠... Iniciando</div>
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>

        <div class="zen-message" id="zenMessage">ÈõÜ‰∏≠ Concentraci√≥n</div>

        <div class="hud">
            <div class="score" id="soloScore">ÂæóÁÇπ <span id="score">0</span></div>
            <div class="score player1" id="player1Score" style="display: none;">
                <span style="font-size: 0.7em;">Èùí</span> Jugador 1: <span id="score1">0</span>
            </div>
            <div class="score player2" id="player2Score" style="display: none;">
                <span style="font-size: 0.7em;">Ê°É</span> Jugador 2: <span id="score2">0</span>
            </div>
            <div class="status" id="status">‰∏°Êâã„Çí‰∏ä„Åí„Å¶ Levanta ambas manos</div>
            <div class="status">Â∞ÑÊíÉ <span id="shots">0</span></div>
            <!-- Wind Indicator -->
            <div class="wind-indicator" id="windIndicator">
                È¢® <span id="windArrow" class="wind-arrow">‚û§</span> <span id="windText">0</span>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn" id="resetBtn">üîÑ „É™„Çª„ÉÉ„Éà REINICIAR</button>
            <button class="control-btn" id="modeBtn">üë• ÂØæÊà¶ MODO VS</button>
            <button class="control-btn" id="achievementsBtn">üèÜ Âã≤Á´† LOGROS</button>
            <button class="control-btn" id="scoresBtn">üìä Ë®òÈå≤ R√âCORDS</button>
            <button class="control-btn" id="musicBtn">üéµ Èü≥Ê•Ω M√öSICA</button>
        </div>

        <div class="info-icon" id="infoIcon"></div>

        <div class="instructions" id="instructions">
            <strong>ÊåáÁ§∫ INSTRUCCIONES</strong><br><br>
            <div class="instruction-item">
                <span class="instruction-icon">üèπ</span>
                <span>Mano derecha arriba = Arco</span>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">üëå</span>
                <span>Junta pulgar e √≠ndice izq. = Tensar</span>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">üéØ</span>
                <span>Aleja la mano = M√°s potencia</span>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">üöÄ</span>
                <span>Separa dedos = ¬°Disparar!</span>
            </div>
            <br>
            <strong>ÁÇπÊï∞ PUNTUACI√ìN</strong><br><br>
            <div class="instruction-item">
                <span class="instruction-icon">üü°</span>
                <span>Centro = 10 puntos</span>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">üî¥</span>
                <span>Rojo = 8 puntos</span>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">üîµ</span>
                <span>Azul = 6 puntos</span>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">‚ö´</span>
                <span>Negro = 4 puntos</span>
            </div>
            <div class="instruction-item">
                <span class="instruction-icon">‚ö™</span>
                <span>Blanco = 2 puntos</span>
            </div>
        </div>

        <div class="target">
            <div class="target-ring ring-1"></div>
            <div class="target-ring ring-2"></div>
            <div class="target-ring ring-3"></div>
            <div class="target-ring ring-4"></div>
            <div class="target-ring ring-5"></div>
        </div>

        <div class="power-label" id="powerLabel">Âäõ POTENCIA</div>
        <div class="power-bar" id="powerBar">
            <div class="power-fill" id="powerFill"></div>
        </div>

        <div class="arrow" id="arrow"></div>
        <div class="arrow player2" id="arrow2" style="display: none;"></div>

        <div class="result-popup" id="resultPopup">
            <div class="result-title">ÁöÑ‰∏≠ HIT</div>
            <div class="result-score" id="resultScore">10</div>
            <div class="result-message" id="resultMessage">ÂÆåÁíß ¬°Perfecto!</div>
            <div class="zen-phrase" id="zenPhrase"></div>
            <button class="continue-btn" id="continueBtn">Á∂ö„Åë„Çã CONTINUAR</button>
        </div>

        <div class="winner-popup" id="winnerPopup">
            <div class="winner-title" id="winnerTitle">ÂãùÂà© VICTORIA</div>
            <div class="winner-scores" id="winnerScores">5 - 3</div>
            <div class="winner-message">‰∫å‰∫∫„Å®„ÇÇÁ¥†Êô¥„Çâ„Åó„ÅÑÊà¶„ÅÑ„Åß„Åó„Åü<br>Ambos lucharon con honor</div>
            <button class="continue-btn" id="newGameBtn">Êñ∞„Åó„ÅÑË©¶Âêà NUEVA PARTIDA</button>
        </div>
    </div>

    <script>
        let video, canvas, ctx;
        let hands, camera;
        let score = 0;
        let score1 = 0;
        let score2 = 0;
        let shots = 0;
        let isDrawing = false;
        let isTensing = false;
        let tensionPower = 0;
        let rightHandPos = null;
        let leftHandPos = null;
        let gameState = 'idle';
        let arrowFlying = false;
        let versusMode = false;
        let currentPlayer = 1;
        let vsRounds = 5;
        let vsCurrentRound = 0;

        // Wind System
        let wind = 0; // -10 to 10

        function updateWind() {
            wind = (Math.random() * 6) - 3; // Random wind between -3 and 3
            const windText = document.getElementById('windText');
            const windArrow = document.getElementById('windArrow');

            windText.textContent = Math.abs(wind).toFixed(1);
            windArrow.style.transform = `rotate(${wind > 0 ? 0 : 180}deg)`;

            // Si el viento es fuerte, mostrar advertencia zen
            if (Math.abs(wind) > 2) {
                // showZenMessage('È¢®„ÇíË™≠„ÇÄ Lee el viento');
            }
        }

        // Achievements Logic
        const achievements = {
            firstBlood: { name: 'ÂàùÊíÉ First Blood', desc: 'Primer disparo al blanco', unlocked: false, icon: 'üéØ' },
            perfectShot: { name: 'ÂÆåÁíß Perfect', desc: '10 puntos en un disparo', unlocked: false, icon: 'üíØ' },
            sharpshooter: { name: 'ÂêçÂ∞ÑÊâã Sharpshooter', desc: '3 disparos perfectos seguidos', unlocked: false, icon: 'üèπ' },
            centurion: { name: 'ÁôæÁÇπ Centurion', desc: 'Alcanza 100 puntos', unlocked: false, icon: 'üíØ' },
            master: { name: 'ÈÅî‰∫∫ Master', desc: '5 disparos perfectos en una partida', unlocked: false, icon: 'üëë' },
            dedication: { name: 'ÁåÆË∫´ Dedication', desc: '50 disparos totales', unlocked: false, icon: 'üî•' }
        };

        let perfectStreak = 0;
        let perfectsInGame = 0;
        let totalShots = 0;

        function checkAchievements(points) {
            const newUnlocks = [];

            if (points > 0 && !achievements.firstBlood.unlocked) {
                achievements.firstBlood.unlocked = true;
                newUnlocks.push('firstBlood');
            }

            if (points === 10) {
                perfectStreak++;
                perfectsInGame++;
                if (!achievements.perfectShot.unlocked) {
                    achievements.perfectShot.unlocked = true;
                    newUnlocks.push('perfectShot');
                }
                if (perfectStreak >= 3 && !achievements.sharpshooter.unlocked) {
                    achievements.sharpshooter.unlocked = true;
                    newUnlocks.push('sharpshooter');
                }
                if (perfectsInGame >= 5 && !achievements.master.unlocked) {
                    achievements.master.unlocked = true;
                    newUnlocks.push('master');
                }
            } else {
                perfectStreak = 0;
            }

            if (score >= 100 && !achievements.centurion.unlocked) {
                achievements.centurion.unlocked = true;
                newUnlocks.push('centurion');
            }

            totalShots++;
            if (totalShots >= 50 && !achievements.dedication.unlocked) {
                achievements.dedication.unlocked = true;
                newUnlocks.push('dedication');
            }

            saveAchievements();
            newUnlocks.forEach(showAchievementUnlock);
        }

        function showAchievementUnlock(achievementKey) {
            const ach = achievements[achievementKey];
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed; top: 80px; right: 20px; z-index: 1000;
                background: rgba(15, 15, 30, 0.98); padding: 20px 30px;
                border: 2px solid rgba(255, 215, 0, 0.8);
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
                font-family: 'Noto Serif JP', serif; color: #ffd700;
                animation: slideIn 0.5s ease-out;
            `;
            popup.innerHTML = `
                <div style="font-size: 2em; text-align: center;">${ach.icon}</div>
                <div style="font-size: 1.2em; margin: 10px 0; text-align: center;">üèÜ LOGRO DESBLOQUEADO</div>
                <div style="font-size: 1em; font-weight: 600;">${ach.name}</div>
                <div style="font-size: 0.85em; color: rgba(255, 215, 0, 0.7);">${ach.desc}</div>
            `;
            document.body.appendChild(popup);
            playSound(1500, 0.3, 'sine');
            setTimeout(() => { popup.remove(); }, 4000);
        }

        function saveAchievements() {
            localStorage.setItem('kyudo_achievements', JSON.stringify(achievements));
            localStorage.setItem('kyudo_stats', JSON.stringify({ totalShots, perfectStreak, perfectsInGame }));
        }

        function loadAchievements() {
            const saved = localStorage.getItem('kyudo_achievements');
            const stats = localStorage.getItem('kyudo_stats');
            if (saved) Object.assign(achievements, JSON.parse(saved));
            if (stats) {
                const s = JSON.parse(stats);
                totalShots = s.totalShots || 0;
                perfectStreak = s.perfectStreak || 0;
                perfectsInGame = s.perfectsInGame || 0;
            }
        }

        // High Scores Logic
        function saveHighScore(newScore) {
            let highScores = JSON.parse(localStorage.getItem('kyudo_highscores') || '[]');
            highScores.push({ score: newScore, date: new Date().toISOString() });
            highScores.sort((a, b) => b.score - a.score);
            highScores = highScores.slice(0, 10);
            localStorage.setItem('kyudo_highscores', JSON.stringify(highScores));
            return highScores;
        }

        function showHighScores() {
            const highScores = JSON.parse(localStorage.getItem('kyudo_highscores') || '[]');
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: rgba(15, 15, 30, 0.98); padding: 40px 60px; z-index: 1000;
                border: 3px solid rgba(255, 215, 0, 0.8);
                box-shadow: 0 0 60px rgba(255, 215, 0, 0.5);
                font-family: 'Noto Serif JP', serif; color: #ffd700;
                max-height: 80vh; overflow-y: auto;
            `;

            let html = '<div style="font-size: 2em; margin-bottom: 20px; text-align: center;">üèÜ ÊÆøÂ†Ç HIGH SCORES</div>';

            if (highScores.length === 0) {
                html += '<div style="text-align: center; color: rgba(255, 215, 0, 0.6);">„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì<br>No hay r√©cords a√∫n</div>';
            } else {
                highScores.forEach((entry, i) => {
                    const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `${i + 1}.`;
                    const date = new Date(entry.date).toLocaleDateString();
                    html += `
                        <div style="padding: 15px; margin: 10px 0; background: rgba(255, 215, 0, 0.1); border-left: 3px solid rgba(255, 215, 0, 0.6);">
                            <span style="font-size: 1.5em; margin-right: 15px;">${medal}</span>
                            <span style="font-size: 1.3em; font-weight: 600;">${entry.score} ÁÇπ</span>
                            <span style="font-size: 0.8em; color: rgba(255, 215, 0, 0.6); margin-left: 10px;">${date}</span>
                        </div>
                    `;
                });
            }

            html += '<button onclick="this.parentElement.remove()" style="margin-top: 20px; padding: 12px 30px; background: rgba(255, 215, 0, 0.1); color: #ffd700; border: 2px solid rgba(255, 215, 0, 0.6); cursor: pointer; font-family: \'Noto Serif JP\', serif; font-size: 1em;">Èñâ„Åò„Çã CERRAR</button>';
            popup.innerHTML = html;
            document.body.appendChild(popup);
        }

        function showAchievementsPanel() {
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: rgba(15, 15, 30, 0.98); padding: 40px 60px; z-index: 1000;
                border: 3px solid rgba(255, 215, 0, 0.8);
                box-shadow: 0 0 60px rgba(255, 215, 0, 0.5);
                font-family: 'Noto Serif JP', serif; color: #ffd700;
                max-height: 80vh; overflow-y: auto; min-width: 400px;
            `;

            let html = '<div style="font-size: 2em; margin-bottom: 20px; text-align: center;">üèÜ Âã≤Á´† LOGROS</div>';

            Object.entries(achievements).forEach(([key, ach]) => {
                const opacity = ach.unlocked ? '1' : '0.3';
                const bgColor = ach.unlocked ? 'rgba(255, 215, 0, 0.15)' : 'rgba(100, 100, 100, 0.1)';
                html += `
                    <div style="padding: 15px; margin: 10px 0; background: ${bgColor}; border-left: 3px solid rgba(255, 215, 0, 0.6); opacity: ${opacity};">
                        <span style="font-size: 2em; margin-right: 15px;">${ach.icon}</span>
                        <div style="display: inline-block; vertical-align: middle;">
                            <div style="font-size: 1.1em; font-weight: 600;">${ach.name}</div>
                            <div style="font-size: 0.85em; color: rgba(255, 215, 0, 0.7);">${ach.desc}</div>
                        </div>
                        ${ach.unlocked ? '<span style="float: right; color: #4CAF50; font-size: 1.5em;">‚úì</span>' : ''}
                    </div>
                `;
            });

            html += '<button onclick="this.parentElement.remove()" style="margin-top: 20px; padding: 12px 30px; background: rgba(255, 215, 0, 0.1); color: #ffd700; border: 2px solid rgba(255, 215, 0, 0.6); cursor: pointer; font-family: \'Noto Serif JP\', serif; font-size: 1em;">Èñâ„Åò„Çã CERRAR</button>';
            popup.innerHTML = html;
            document.body.appendChild(popup);
        }

        // Background Music
        const bgMusic = {
            context: null,
            playing: false,
            init() {
                try {
                    this.context = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) { console.error('AudioContext not supported'); }
            },
            playTraditional() {
                if (this.playing || !this.context) return;
                this.playing = true;
                if (this.context.state === 'suspended') this.context.resume();

                const notes = [
                    { freq: 293.66, dur: 0.5 }, { freq: 329.63, dur: 0.5 }, { freq: 369.99, dur: 0.5 },
                    { freq: 392.00, dur: 1.0 }, { freq: 369.99, dur: 0.5 }, { freq: 329.63, dur: 0.5 },
                    { freq: 293.66, dur: 1.0 },
                ];

                let time = this.context.currentTime;
                const playLoop = () => {
                    if (!this.playing) return;
                    notes.forEach(note => {
                        const osc = this.context.createOscillator();
                        const gain = this.context.createGain();
                        osc.connect(gain);
                        gain.connect(this.context.destination);
                        osc.frequency.value = note.freq;
                        osc.type = 'sine';
                        gain.gain.setValueAtTime(0.05, time); // Volumen bajo
                        gain.gain.exponentialRampToValueAtTime(0.001, time + note.dur);
                        osc.start(time);
                        osc.stop(time + note.dur);
                        time += note.dur;
                    });
                    // Loop 
                    setTimeout(() => {
                        if (this.playing) {
                            time = this.context.currentTime;
                            playLoop();
                        }
                    }, notes.reduce((sum, n) => sum + n.dur, 0) * 1000 + 3000);
                };
                playLoop();
            },
            stop() { this.playing = false; },
            toggle() {
                if (this.playing) { this.stop(); return false; }
                else { this.playTraditional(); return true; }
            }
        };

        // Sound effects
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(frequency, duration, type = 'sine') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playBowTension() { playSound(200 + tensionPower * 2, 0.1, 'triangle'); }
        function playShootSound() { playSound(800, 0.3, 'sawtooth'); setTimeout(() => playSound(400, 0.2, 'sine'), 100); }
        function playHitSound(points) {
            if (points >= 8) { playSound(1200, 0.2, 'sine'); setTimeout(() => playSound(1500, 0.2, 'sine'), 150); }
            else if (points >= 4) { playSound(800, 0.2, 'sine'); }
            else { playSound(400, 0.3, 'triangle'); }
        }
        function playMissSound() { playSound(200, 0.5, 'sawtooth'); }

        const startBtn = document.getElementById('startBtn');
        const introScreen = document.getElementById('introScreen');
        const gameContainer = document.getElementById('gameContainer');
        const loading = document.getElementById('loading');
        const infoIcon = document.getElementById('infoIcon');
        const instructions = document.getElementById('instructions');
        const resetBtn = document.getElementById('resetBtn');
        const modeBtn = document.getElementById('modeBtn');

        // Buttons listeners
        document.getElementById('achievementsBtn').addEventListener('click', showAchievementsPanel);
        document.getElementById('scoresBtn').addEventListener('click', showHighScores);
        document.getElementById('musicBtn').addEventListener('click', (e) => {
            if (!bgMusic.context) bgMusic.init();
            const playing = bgMusic.toggle();
            e.target.classList.toggle('active', playing);
        });

        infoIcon.addEventListener('click', () => { instructions.classList.toggle('show'); });
        resetBtn.addEventListener('click', () => { resetGame(); playSound(440, 0.3, 'sine'); });
        modeBtn.addEventListener('click', () => {
            versusMode = !versusMode;
            resetGame();
            updateModeUI();
            playSound(versusMode ? 600 : 440, 0.3, 'sine');
        });

        function resetGame() {
            score = 0; score1 = 0; score2 = 0; shots = 0; vsCurrentRound = 0; currentPlayer = 1;
            gameState = 'idle'; arrowFlying = false; tensionPower = 0;
            perfectStreak = 0;

            document.getElementById('score').textContent = '0';
            document.getElementById('score1').textContent = '0';
            document.getElementById('score2').textContent = '0';
            document.getElementById('shots').textContent = '0';
            document.getElementById('arrow').style.display = 'none';
            document.getElementById('arrow2').style.display = 'none';
            document.getElementById('resultPopup').classList.remove('show');
            document.getElementById('winnerPopup').classList.remove('show');

            updateWind(); // New wind on reset
            updateStatus(versusMode ? (currentPlayer === 1 ? 'Èùí Turno Jugador 1' : 'Ê°É Turno Jugador 2') : 'Ê∫ñÂÇô Preparado');
        }

        function updateModeUI() {
            const soloScore = document.getElementById('soloScore');
            const player1Score = document.getElementById('player1Score');
            const player2Score = document.getElementById('player2Score');

            if (versusMode) {
                soloScore.style.display = 'none';
                player1Score.style.display = 'block';
                player2Score.style.display = 'block';
                modeBtn.classList.add('active');
                modeBtn.textContent = 'üë§ „ÇΩ„É≠ MODO SOLO';
            } else {
                soloScore.style.display = 'block';
                player1Score.style.display = 'none';
                player2Score.style.display = 'none';
                modeBtn.classList.remove('active');
                modeBtn.textContent = 'üë• ÂØæÊà¶ MODO VS';
            }
        }

        startBtn.addEventListener('click', async () => {
            introScreen.classList.add('hidden');
            setTimeout(() => { introScreen.style.display = 'none'; }, 800);
            gameContainer.classList.add('active');
            playSound(440, 0.3, 'sine');
            loadAchievements();
            bgMusic.init();
            updateWind();
            await initCamera();
        });

        async function initCamera() {
            video = document.getElementById('video');
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 1280, height: 720 } });
                video.srcObject = stream;
                video.onloadedmetadata = () => { video.play(); loading.style.display = 'none'; initHands(); };
            } catch (err) {
                console.error('Error accessing camera:', err);
                loading.textContent = 'Error al acceder a la c√°mara. Por favor permite el acceso.';
            }
        }

        function initHands() {
            hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
            hands.setOptions({ maxNumHands: 2, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });
            hands.onResults(onResults);
            camera = new Camera(video, { onFrame: async () => { await hands.send({ image: video }); }, width: 1280, height: 720 });
            camera.start();
        }

        function onResults(results) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (results.multiHandLandmarks && results.multiHandedness) {
                rightHandPos = null; leftHandPos = null;
                for (let i = 0; i < results.multiHandLandmarks.length; i++) {
                    const landmarks = results.multiHandLandmarks[i];
                    const handedness = results.multiHandedness[i].label;
                    const actualHand = handedness === 'Left' ? 'Right' : 'Left';
                    drawHand(landmarks, actualHand);
                    if (actualHand === 'Right') { rightHandPos = landmarks[9]; }
                    else if (actualHand === 'Left') { leftHandPos = landmarks; }
                }
                processGestures();
            }
            if (gameState === 'shooting' && arrowFlying) { updateArrow(); }
        }

        function drawHand(landmarks, hand) {
            ctx.fillStyle = hand === 'Right' ? 'rgba(255, 100, 100, 0.5)' : 'rgba(100, 100, 255, 0.5)';
            landmarks.forEach(landmark => {
                const x = canvas.width - (landmark.x * canvas.width);
                const y = landmark.y * canvas.height;
                ctx.beginPath(); ctx.arc(x, y, 5, 0, 2 * Math.PI); ctx.fill();
            });
        }

        function processGestures() {
            if (!rightHandPos || !leftHandPos) {
                if (gameState === 'tensing') {
                    gameState = 'idle';
                    document.getElementById('powerBar').style.display = 'none';
                    document.getElementById('powerLabel').style.display = 'none';
                }
                updateStatus('‰∏°Êâã„Çí‰∏ä„Åí„Å¶ Levanta ambas manos');
                return;
            }

            const thumbTip = leftHandPos[4];
            const indexTip = leftHandPos[8];
            const pinchDistance = Math.sqrt(Math.pow(thumbTip.x - indexTip.x, 2) + Math.pow(thumbTip.y - indexTip.y, 2) + Math.pow(thumbTip.z - indexTip.z, 2));
            const isPinching = pinchDistance < 0.05;

            if (isPinching && gameState !== 'shooting' && !arrowFlying) {
                const rightX = canvas.width - (rightHandPos.x * canvas.width);
                const rightY = rightHandPos.y * canvas.height;
                const leftX = canvas.width - (indexTip.x * canvas.width);
                const leftY = indexTip.y * canvas.height;
                const distance = Math.sqrt(Math.pow(rightX - leftX, 2) + Math.pow(rightY - leftY, 2));

                const oldPower = tensionPower;
                tensionPower = Math.min(100, (distance / 300) * 100);

                if (tensionPower > 20) {
                    if (gameState !== 'tensing') { gameState = 'tensing'; showZenMessage('ÈõÜ‰∏≠ Concentraci√≥n'); }
                    document.getElementById('powerBar').style.display = 'block';
                    document.getElementById('powerLabel').style.display = 'block';
                    document.getElementById('powerFill').style.width = tensionPower + '%';
                    updateStatus(`ÂºµÂäõ Tensi√≥n... ${Math.round(tensionPower)}%`);
                    if (Math.abs(tensionPower - oldPower) > 5) playBowTension();
                    drawBow(rightX, rightY, leftX, leftY);
                }
            } else if (gameState === 'tensing' && !isPinching) {
                shootArrow();
            }

            if (!isPinching && gameState === 'idle') updateStatus('Ë¶™Êåá„Å®‰∫∫Â∑Æ„ÅóÊåá„ÇíÂêà„Çè„Åõ„Çã Junta pulgar e √≠ndice');
        }

        function drawBow(rightX, rightY, leftX, leftY) {
            ctx.strokeStyle = '#8B4513'; ctx.lineWidth = 10; ctx.lineCap = 'round'; ctx.shadowBlur = 15;
            ctx.shadowColor = 'rgba(139, 69, 19, 0.5)';
            ctx.beginPath(); ctx.arc(rightX, rightY, 80, -Math.PI / 3, Math.PI / 3); ctx.stroke(); ctx.shadowBlur = 0;

            ctx.strokeStyle = 'rgba(255, 215, 0, 0.9)'; ctx.lineWidth = 2; ctx.shadowBlur = 10;
            ctx.shadowColor = 'rgba(255, 215, 0, 0.8)';
            ctx.beginPath();
            const topX = rightX + Math.cos(-Math.PI / 3) * 80; const topY = rightY + Math.sin(-Math.PI / 3) * 80;
            const bottomX = rightX + Math.cos(Math.PI / 3) * 80; const bottomY = rightY + Math.sin(Math.PI / 3) * 80;
            ctx.moveTo(topX, topY); ctx.lineTo(leftX, leftY); ctx.lineTo(bottomX, bottomY); ctx.stroke(); ctx.shadowBlur = 0;

            ctx.strokeStyle = '#D2691E'; ctx.lineWidth = 5; ctx.shadowBlur = 8;
            ctx.shadowColor = 'rgba(255, 215, 0, 0.6)';
            ctx.beginPath(); ctx.moveTo(leftX, leftY); ctx.lineTo(rightX, rightY); ctx.stroke(); ctx.shadowBlur = 0;

            const angle = Math.atan2(rightY - leftY, rightX - leftX);
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.moveTo(leftX, leftY);
            ctx.lineTo(leftX + Math.cos(angle - 0.5) * 15, leftY + Math.sin(angle - 0.5) * 15);
            ctx.lineTo(leftX + Math.cos(angle + 0.5) * 15, leftY + Math.sin(angle + 0.5) * 15);
            ctx.closePath(); ctx.fill();
        }

        function showZenMessage(message) {
            const zenMsg = document.getElementById('zenMessage');
            zenMsg.textContent = message; zenMsg.classList.add('show');
            setTimeout(() => { zenMsg.classList.remove('show'); }, 2000);
        }

        function shootArrow() {
            if (arrowFlying) return;
            gameState = 'shooting'; arrowFlying = true; shots++;
            document.getElementById('shots').textContent = shots;
            document.getElementById('powerBar').style.display = 'none';
            document.getElementById('powerLabel').style.display = 'none';

            playShootSound(); showZenMessage('Êîæ„Å§ ¬°Dispara!');

            const arrowId = versusMode && currentPlayer === 2 ? 'arrow2' : 'arrow';
            const arrow = document.getElementById(arrowId);
            if (versusMode && currentPlayer === 2) arrow.classList.add('player2');
            else if (versusMode && currentPlayer === 1) arrow.classList.add('player1');

            const rightX = canvas.width - (rightHandPos.x * canvas.width);
            const rightY = rightHandPos.y * canvas.height;
            const target = document.querySelector('.target');
            const targetRect = target.getBoundingClientRect();
            const targetX = targetRect.left + targetRect.width / 2;
            const targetY = targetRect.top + targetRect.height / 2;
            const angle = Math.atan2(targetY - rightY, targetX - rightX);

            arrow.style.left = rightX + 'px'; arrow.style.top = rightY + 'px';
            arrow.style.transform = `rotate(${angle}rad)`; arrow.style.display = 'block';

            const speed = tensionPower / 10;
            arrow.dataset.vx = Math.cos(angle) * speed;
            arrow.dataset.vy = Math.sin(angle) * speed;
            arrow.dataset.x = rightX; arrow.dataset.y = rightY;

            updateStatus('È£õË°å‰∏≠ ¬°Flecha en vuelo!');
        }

        function updateArrow() {
            const arrowId = versusMode && currentPlayer === 2 ? 'arrow2' : 'arrow';
            const arrow = document.getElementById(arrowId);
            let x = parseFloat(arrow.dataset.x); let y = parseFloat(arrow.dataset.y);
            const vx = parseFloat(arrow.dataset.vx); const vy = parseFloat(arrow.dataset.vy);

            // Apply wind effect
            x += vx * 10 - wind; // Wind affects x position
            y += vy * 10;

            arrow.style.left = x + 'px'; arrow.style.top = y + 'px';
            arrow.dataset.x = x; arrow.dataset.y = y;

            const target = document.querySelector('.target');
            const targetRect = target.getBoundingClientRect();
            const targetCenterX = targetRect.left + targetRect.width / 2;
            const targetCenterY = targetRect.top + targetRect.height / 2;
            const distance = Math.sqrt(Math.pow(x - targetCenterX, 2) + Math.pow(y - targetCenterY, 2));

            if (distance < 100 || x > window.innerWidth || y < 0 || y > window.innerHeight) {
                arrowFlying = false; arrow.style.display = 'none';
                calculateScore(distance);
            }
        }

        function calculateScore(distance) {
            let points = 0; let message = ''; let zenPhrase = '';
            if (distance < 20) { points = 10; message = 'ÂÆåÁíß ¬°PERFECTO!'; zenPhrase = 'ÂøÉ„Åå‰∏Ä„Å§„Å´„Å™„Å£„Åü El esp√≠ritu es uno'; playHitSound(10); }
            else if (distance < 40) { points = 8; message = 'Á¥†Êô¥„Çâ„Åó„ÅÑ ¬°Excelente!'; zenPhrase = 'ËâØ„ÅÑÈõÜ‰∏≠ Buena concentraci√≥n'; playHitSound(8); }
            else if (distance < 60) { points = 6; message = '„Çà„Åè„ÇÑ„Å£„Åü ¬°Muy bien!'; zenPhrase = 'ÈÅì„ÅØÁ∂ö„Åè El camino contin√∫a'; playHitSound(6); }
            else if (distance < 80) { points = 4; message = 'ËâØ„ÅÑ ¬°Bien!'; zenPhrase = 'Á∑¥Áøí„ÅÇ„Çã„ÅÆ„Åø Solo pr√°ctica'; playHitSound(4); }
            else if (distance < 100) { points = 2; message = 'ÁöÑ‰∏≠ ¬°En el blanco!'; zenPhrase = 'Âßã„Åæ„Çä„Å´ÈÅé„Åé„Å™„ÅÑ Es solo el comienzo'; playHitSound(2); }
            else { points = 0; message = 'Â§ñ„Çå„Åü Fallaste'; zenPhrase = 'Â§±Êïó„ÅØÂ≠¶„Å≥„ÅÆÊØç El error ense√±a'; playMissSound(); }

            checkAchievements(points);

            if (versusMode) {
                if (currentPlayer === 1) { score1 += points; document.getElementById('score1').textContent = score1; }
                else { score2 += points; document.getElementById('score2').textContent = score2; }
                vsCurrentRound++;
                if (vsCurrentRound >= vsRounds * 2) { showWinner(); }
                else { currentPlayer = currentPlayer === 1 ? 2 : 1; showResult(points, message, zenPhrase); }
            } else {
                score += points; document.getElementById('score').textContent = score;
                showResult(points, message, zenPhrase);
            }
            updateWind(); // Change wind on every shot
        }

        function showResult(points, message, zenPhrase) {
            gameState = 'result';
            document.getElementById('resultScore').textContent = points;
            document.getElementById('resultMessage').textContent = message;
            document.getElementById('zenPhrase').textContent = zenPhrase;
            document.getElementById('resultPopup').classList.add('show');

            if (!versusMode) saveHighScore(score);
        }

        function showWinner() {
            const winnerPopup = document.getElementById('winnerPopup');
            const winnerTitle = document.getElementById('winnerTitle');
            const winnerScores = document.getElementById('winnerScores');
            if (score1 > score2) { winnerTitle.textContent = 'Èùí JUGADOR 1 GANA'; winnerTitle.className = 'winner-title player1'; }
            else if (score2 > score1) { winnerTitle.textContent = 'Ê°É JUGADOR 2 GANA'; winnerTitle.className = 'winner-title player2'; }
            else { winnerTitle.textContent = 'Âºï„ÅçÂàÜ„Åë EMPATE'; winnerTitle.className = 'winner-title'; }
            winnerScores.textContent = `${score1} - ${score2}`;
            winnerPopup.classList.add('show');
        }

        document.getElementById('continueBtn').addEventListener('click', () => {
            document.getElementById('resultPopup').classList.remove('show');
            gameState = 'idle'; tensionPower = 0;
            if (versusMode) updateStatus(currentPlayer === 1 ? 'Èùí Turno Jugador 1' : 'Ê°É Turno Jugador 2');
            else updateStatus('Ê∫ñÂÇô Prepara el siguiente tiro');
            playSound(440, 0.2, 'sine');
        });
        document.getElementById('newGameBtn').addEventListener('click', () => {
            document.getElementById('winnerPopup').classList.remove('show');
            resetGame(); playSound(440, 0.3, 'sine');
        });

        function updateStatus(text) { document.getElementById('status').textContent = text; }
        window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
    </script>
</body>

</html>
